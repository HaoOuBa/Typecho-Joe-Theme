(()=>{class Joe{constructor(t){t={reloadTime:t.reloadTime||1500},this.options=t,this.video_page=0,this.video_canLoad=!0,this.wallpaper_page=0,this.wallpaper_cid="",this.init()}init(){$(document).on("touchstart",t=>{}),this.init_day_light(),this.init_url_hash(),this.init_document_title(),this.init_document_barrager(),this.init_document_progress(),this.init_document_live2d(),this.init_document_contextmenu(),this.init_document_theme(),this.init_hover_music(),this.init_back_top(),this.init_document_census(),this.init_high_light(),this.init_document_console(),this.init_document_weather(),this.init_3d_tag(),this.init_load_more(),this.init_document_swiper(),this.init_document_analysis(),this.init_owo(),this.init_replay_see(),this.init_draw(),this.init_admire(),this.init_thumbs_up(),this.init_share_code(),this.init_copy(),this.init_synth(),this.init_typecho_comment(),this.init_markdown(),this.init_baidu_collect(),this.init_typing(),this.init_life_time(),this.init_aside_reply(),this.init_file_toggle(),this.init_floor_click(),this.init_drop_down(),this.init_panel_down(),this.init_aside_config(),this.init_sign_verify(),this.init_pagination_hash(),this.init_replay_content(),this.init_comment(),this.init_leaving(),this.init_wap_search_click(),this.init_search_verify(),this.init_protect_verify(),this.init_dynamic_verify(),this.init_comment_submit(),this.init_wap_cloud(),this.init_wap_search(),this.init_wap_sidebar(),this.init_wow(),this.init_video_list_type(),this.init_video_list(),this.init_video_search(),this.init_load_more_video(),this.init_video_detail(),this.init_j_tabs(),this.init_j_collapse(),this.init_aside_motto(),this.init_comment_like(),this.init_dynamic_reply(),this.init_video_album(),this.init_wallpaper(),this.init_huya_type(),this.init_huya_skip(),this.init_huya_pagination(),this.init_lazy_load()}init_day_light(){$("#j-day-night").on("click",function(){$(this).toggleClass("dark"),$(this).hasClass("dark")?($("html").attr("dark",!0),localStorage.setItem("dark",1)):($("html").removeAttr("dark"),localStorage.removeItem("dark")),handleMode()})}changeURLArg(url,arg,arg_val){var pattern=arg+"=([^&]*)",replaceText=arg+"="+arg_val;if(url.match(pattern)){var tmp="/("+arg+"=)([^&]*)/gi";return tmp=url.replace(eval(tmp),replaceText),tmp}return url.match("[?]")?url+"&"+replaceText:url+"?"+replaceText}init_url_hash(){let t=new URLSearchParams(location.search);if(t.get("jscroll")&&$("#"+t.get("jscroll")).length>0){let e=setTimeout(()=>{window.scroll({top:$("#"+t.get("jscroll")).offset().top-($(".j-header").height()+20),behavior:"smooth"}),clearTimeout(e)},300)}}init_document_title(){if(""===window.JOE_CONFIG.DOCUMENT_TITLE||"on"===window.JOE_CONFIG.IS_MOBILE)return;const t=document.title;$(document).on("visibilitychange",function(){"hidden"===document.visibilityState?document.title=window.JOE_CONFIG.DOCUMENT_TITLE:document.title=t})}init_document_barrager(){"off"!==window.JOE_CONFIG.DOCUMENT_BARRAGER&&("on"===localStorage.getItem("barragerStatus")?($("#barrager").attr("checked",!0),$(".j-barrager").css({opacity:1,visibility:"visible"})):($("#barrager").attr("checked",!1),$(".j-barrager").css({opacity:0,visibility:"hidden"})),$("#barrager").on("change",function(){localStorage.setItem("barragerStatus",$(this).prop("checked")?"on":"off"),$("#barrager").prop("checked")?$(".j-barrager").css({opacity:1,visibility:"visible"}):$(".j-barrager").css({opacity:0,visibility:"hidden"})}))}init_document_progress(){if("off"===window.JOE_CONFIG.DOCUMENT_PROGRESS)return;let t=()=>{let t=$(window).scrollTop(),e=$(document).height(),i=$(window).height(),a=parseInt(t/(e-i)*100);a<0&&(a=0),a>100&&(a=100),$("#progress").css("width",a+"%")};t(),$(window).on("scroll",()=>t())}init_document_live2d(){"off"!==window.JOE_CONFIG.DOCUMENT_LIVE2D&&"on"!==window.JOE_CONFIG.IS_MOBILE&&L2Dwidget.init({model:{jsonPath:window.JOE_CONFIG.DOCUMENT_LIVE2D,scale:1},mobile:{show:!1},display:{position:"right",width:160,height:200,hOffset:70,vOffset:0}})}init_document_contextmenu(){"off"!==window.JOE_CONFIG.DOCUMENT_CONTEXTMENU&&"on"!==window.JOE_CONFIG.IS_MOBILE&&$(document).on("contextmenu",()=>!1)}init_document_theme(){if("on"===window.JOE_CONFIG.DOCUMENT_THEME_STATUS){window.JOE_CONFIG.DOCUMENT_GLOBAL_THEME?$("body").css("--theme",localStorage.getItem("--theme")||window.JOE_CONFIG.DOCUMENT_GLOBAL_THEME):$("body").css("--theme",localStorage.getItem("--theme")||"#4e7cf2");let t=null;t=localStorage.getItem("--theme")?localStorage.getItem("--theme"):window.JOE_CONFIG.DOCUMENT_GLOBAL_THEME?window.JOE_CONFIG.DOCUMENT_GLOBAL_THEME:"#4e7cf2",$("#colorPick").colpick({flat:!0,layout:"hex",submit:!1,color:t,colorScheme:"dark",onChange(t,e,i){$("body").css("--theme","#"+e),localStorage.setItem("--theme","#"+e)}}),$("#openColorPick").on("click",function(t){t.stopPropagation(),$("#colorPick").toggleClass("active")}),$("#colorPick").on("click",function(t){t.stopPropagation()}),$(document).on("click",function(t){$("#colorPick").removeClass("active")})}else""===window.JOE_CONFIG.DOCUMENT_GLOBAL_THEME?$("body").css("--theme","#4e7cf2"):$("body").css("--theme",window.JOE_CONFIG.DOCUMENT_GLOBAL_THEME)}init_hover_music(){if("off"===window.JOE_CONFIG.DOCUMENT_HOVER_MUSIC||"on"===window.JOE_CONFIG.IS_MOBILE)return;let t=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;$(".j-hover-music").on("mouseover",function(){$("#j-hover-music").attr("src",window.JOE_CONFIG.THEME_URL+"/assets/audio/"+t(1,8)+".ogv")})}init_back_top(){if("off"===window.JOE_CONFIG.DOCUMENT_BACK_TOP)return;let t=()=>{$(window).scrollTop()>500?$("#backToTop").addClass("active"):$("#backToTop").removeClass("active")};t(),$(window).on("scroll",()=>t()),$("#backToTop").on("click",()=>{window.scroll({top:0,behavior:"smooth"})})}init_document_census(){"off"!==window.JOE_CONFIG.DOCUMENT_CENSUS.status&&Highcharts.chart("census",{title:{text:null},subtitle:{text:null},xAxis:{text:null,categories:["页面","文章","评论","分类"]},yAxis:{title:{text:null}},credits:{enabled:!1},series:[{name:"数量",type:"column",colorByPoint:!0,data:window.JOE_CONFIG.DOCUMENT_CENSUS.data,showInLegend:!1}]})}init_high_light(){"off"!==window.JOE_CONFIG.DOCUMENT_HIGHT_LIGHT&&hljs.initHighlighting()}init_document_console(){function t(t,e){t||(!function(t){function e(t){function e(){return d}function i(){window.Firebug&&window.Firebug.chrome&&window.Firebug.chrome.isInitialized?a("on"):(r="off",console.log(l),console.clear(),a(r))}function a(t){d!==t&&(d=t,"function"==typeof s.onchange&&s.onchange(t))}function n(){c||(c=!0,window.removeEventListener("resize",i),clearInterval(h))}"function"==typeof t&&(t={onchange:t});var o=(t=t||{}).delay||500,s={};s.onchange=t.onchange;var r,l=new Image;l.__defineGetter__("id",function(){r="on"});var d="unknown";s.getStatus=e;var c,h=setInterval(i,o);return window.addEventListener("resize",i),s.free=n,s}var i=i||{};i.create=e,"function"==typeof define?(define.amd||define.cmd)&&define(function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:window.jdetects=i}(),jdetects.create(function(t){var i=0;setInterval(function(){"on"==t&&setTimeout(function(){0==i&&(i=1,setTimeout(e))},200)},100)}))}"off"!=window.JOE_CONFIG.DOCUMENT_CONSOLE&&t(!1,function(){window.location.href=window.JOE_CONFIG.THEME_URL+"/console.html"})}init_document_weather(){if(""===window.JOE_CONFIG.DOCUMENT_WEATHER_KEY)return;window.WIDGET={CONFIG:{layout:2,width:"220",height:"270",background:"auto"===window.JOE_CONFIG.DOCUMENT_WEATHER_TYPE?1:2,dataColor:"auto"===window.JOE_CONFIG.DOCUMENT_WEATHER_TYPE?"ffffff":"303133",key:window.JOE_CONFIG.DOCUMENT_WEATHER_KEY}};let t=setTimeout(()=>{$(".aside-wether .loading").addClass("active"),clearTimeout(t)},1e3)}init_3d_tag(){if("off"===window.JOE_CONFIG.DOCUMENT_3D_TAG)return;let t=[];$("#cloudList li").each(function(e,i){t.push({label:$(i).attr("data-label"),url:$(i).attr("data-url"),target:"_blank"})}),$("#cloud").svg3DTagCloud({entries:t,width:220,height:230,radius:"65%",radiusMin:75,bgDraw:!0,bgColor:"#000",opacityOver:1,opacityOut:.05,opacitySpeed:6,fov:800,speed:.5,fontSize:13,fontColor:"#fff",fontWeight:"500",fontStyle:"normal",fontStretch:"normal",fontToUpperCase:!0})}init_load_more(){if("ajax"!==window.JOE_CONFIG.DOCUMENT_LOAD_MORE)return;let t=this;$(".j-loadmore a").attr("data-href",$(".j-loadmore a").attr("href")),$(".j-loadmore a").removeAttr("href"),$(".j-loadmore a").on("click",function(){if($(this).attr("disabled"))return;$(this).html("loading..."),$(this).attr("disabled",!0);let e=$(this).attr("data-href");e&&$.ajax({url:e,type:"get",success:e=>{$(this).removeAttr("disabled"),$(this).html("查看更多");let i=$(e).find(".article-list:not(.sticky)");$(".j-index-article.article").append(i),window.scroll({top:$(i).first().offset().top-($(".j-header").height()+20),behavior:"smooth"});let a=$(e).find(".j-loadmore a").attr("href");a?$(this).attr("data-href",a):$(".j-loadmore").remove(),t.init_lazy_load()}})})}init_document_swiper(){if("off"===window.JOE_CONFIG.DOCUMENT_SWIPER||!Swiper)return;let t=$("#recommend").length>0?"vertical":"horizontal";new Swiper(".swiper-container",{direction:t,slidesPerView:1,spaceBetween:20,mousewheel:!0,autoplay:{delay:2500,disableOnInteraction:!1},pagination:{el:".swiper-pagination",clickable:!0}})}init_document_analysis(){0!==$("#j-video").length&&($("#j-dplayer").attr("src",$("#j-dplayer").attr("data-src")+$("#j-video .episodes ul li").first().attr("data-url")),$("#j-video .episodes ul li").first().addClass("active"),$("#j-video .player-box .title span").html("正在播放："+$("#j-video .episodes ul li span").first().html()),$("#j-video .episodes ul li").on("click",function(){$("#j-video .episodes ul li").removeClass("active"),$(this).addClass("active"),$("#j-dplayer").attr("src",$("#j-dplayer").attr("data-src")+$(this).attr("data-url")),$("#j-video .player-box .title span").html("正在播放："+$(this).find("span").html())}))}init_owo(){0!==$("#OwO_Container").length&&(new OwO({logo:"OωO表情",container:document.getElementsByClassName("OwO")[0],target:document.getElementsByClassName("OwO-textarea")[0],api:"/usr/themes/Typecho-Joe-Theme/OwO.json",position:"down",width:"100%",maxHeight:"250px"}),$(document).on("click",function(){$(".OwO").removeClass("OwO-open")}))}init_replay_see(){$(".need-reply span").on("click",function(){let t=$(this).attr("data-href");window.scrollTo({top:$("#"+t).offset().top-($(".j-header").height()+20),behavior:"smooth"})})}init_draw(){0!==$("#draw").length&&(window.sketchpad=new Sketchpad({element:"#draw",height:300,penSize:5,color:"303133"}),$("#commentTypeContent .undo").on("click",function(){window.sketchpad.undo()}),$("#commentTypeContent .animate").on("click",function(){window.sketchpad.animate(10)}),$("#commentTypeContent .canvas ul li").on("click",function(){window.sketchpad.penSize=$(this).attr("data-line"),$("#commentTypeContent .canvas ul li").removeClass("active"),$(this).addClass("active")}),$("#commentTypeContent .canvas ol li").on("click",function(){window.sketchpad.color=$(this).attr("data-color"),$("#commentTypeContent .canvas ol li").removeClass("active"),$(this).addClass("active")}))}init_admire(){$("#j-admire").on("click",function(){$(".j-admire-modal").addClass("active"),$("body").css("overflow","hidden")}),$(".j-admire-modal .close").on("click",function(){$(".j-admire-modal").removeClass("active"),$("body").css("overflow","")})}init_thumbs_up(){$("#j-thumbs-up").on("click",function(){if($(this).attr("disabled"))return $.toast({type:"warning",message:"本篇文章您已经赞过~"});$(this).find("span").html("loading..."),$.ajax({type:"post",url:$(this).attr("data-url"),data:"agree="+$(this).attr("data-cid"),timeout:3e4,cache:!1,success:function(t){let e=/\d/;e.test(t)&&$("#j-thumbs-up span").html("赞 · "+t.trim()),$.toast({type:"success",message:"感谢您的点赞！"}),$("#j-thumbs-up").attr("disabled","disabled")}})})}init_share_code(){0!==$("#j-share-code").length&&$("#j-share-code").qrcode({render:"canvas",width:90,height:90,text:encodeURI(window.location.href),background:"#ffffff",foreground:"#000000",correctLevel:0})}init_copy(){$(".j-copy").on("click",function(t){t.preventDefault(),$("body").append(`<input id="copyInput" value="${$(this).attr("data-copy")}"/>`),$("#copyInput").select(),document.execCommand("copy"),$.toast({type:"success",message:"已复制到剪切板中~"}),$("#copyInput").remove()})}init_synth(){if(!window.speechSynthesis)return $("#read").remove();$("#read").on("click",function(){const t=window.speechSynthesis,e=new SpeechSynthesisUtterance;"朗读"===$(this).find("span").html()?(e.lang="zh-CN",e.text=$("#markdown").text(),t.speak(e),$(this).find("span").html("停止朗读")):(t.cancel(e),$(this).find("span").html("朗读"))})}init_typecho_comment(){window.TypechoComment={dom:function(t){return document.getElementById(t)},create:function(t,e){var i=document.createElement(t);for(var a in e)i.setAttribute(a,e[a]);return i},reply:function(t,e){var i=this.dom(t),a=(i.parentNode,this.dom($(".j-comment").attr("data-respondid"))),n=this.dom("comment-parent"),o="form"==a.tagName?a:a.getElementsByTagName("form")[0],s=a.getElementsByTagName("textarea")[0];if(null==n&&(n=this.create("input",{type:"hidden",name:"parent",id:"comment-parent"}),o.appendChild(n)),n.setAttribute("value",e),null==this.dom("comment-form-place-holder")){var r=this.create("div",{id:"comment-form-place-holder"});a.parentNode.insertBefore(r,a)}return 0===$(i).find(a).length&&i.appendChild(a),this.dom("cancel-comment-reply-link").style.display="",null!=s&&"text"==s.name&&window.scroll({top:$("#li-"+t).offset().top-($(".j-header").height()+20),behavior:"smooth"}),!1},cancelReply:function(){var t=this.dom($(".j-comment").attr("data-respondid")),e=this.dom("comment-form-place-holder"),i=this.dom("comment-parent");return null!=i&&i.parentNode.removeChild(i),null==e||(this.dom("cancel-comment-reply-link").style.display="none",e.parentNode.insertBefore(t,e),window.scroll({top:$("#comments").offset().top-($(".j-header").height()+20),behavior:"smooth"}),!1)}}}init_markdown(){$("#markdown a:not(a[no-target])").attr({target:"_blank"}),$("#markdown img:not(img.owo)").each(function(){let t=document.createElement("a");$(t).attr("data-fancybox","gallery"),$(t).attr("href",$(this).attr("data-original")||$(this).attr("src")),$(this).wrap(t)}),$("code.hljs").parent().addClass("hljs-pre"),$("code.hljs").each(function(){$(this).html("<ol><li>"+$(this).html().replace(/\n/g,"\n</li><li>")+"\n</li></ol>")})}init_baidu_collect(){$.ajax({url:window.JOE_CONFIG.THEME_URL+"/baiduRecord.php?url="+encodeURI(window.location.href),method:"get",success(t){t.success?"未收录"===t.data.baidu?""===window.JOE_CONFIG.DOCUMENT_BAIDU_TOKEN?$("#baiduIncluded").html(`<a target="_blank" href="https://ziyuan.baidu.com/linksubmit/url?sitename=${encodeURI(window.location.href)}">未收录，去提交</a>`):$("#baiduIncluded").html("<span>未收录，点击推送</span>"):($("#baiduIncluded").html("百度已收录"),$("#baiduIncluded").css("color","#3bca72")):($("#baiduIncluded").html("查询失败"),$("#baiduIncluded").css("color","#f56c6c"))}}),$(document).on("click","#baiduIncluded span",function(){$.ajax({url:window.JOE_CONFIG.THEME_URL+"/baiduPush.php?urls="+encodeURI(window.location.href),method:"get",dataType:"json",data:{token:window.JOE_CONFIG.DOCUMENT_BAIDU_TOKEN,domain:window.location.hostname},success:t=>{let e={"site error":"站点未验证！","empty content":"内容为空！","only 2000 urls are allowed once":"超过限制！","over quota":"今日提交已上限"};t.success?($("#baiduIncluded").css("color","#3bca72"),$("#baiduIncluded").html("推送成功！")):($("#baiduIncluded").css("color","#e6a23c"),401===t.error?$("#baiduIncluded").html("Token错误！"):400===t.error?$("#baiduIncluded").html(e[t.message]||"未知错误"):404===t.error?$("#baiduIncluded").html("地址错误！"):$("#baiduIncluded").html("服务异常！"))}})})}init_typing(){$(".j-typing").each(function(t,e){$(e).show(),$(e).css("opacity",1);let i=$(e).html(),a=null,n=0,o=()=>{n<=i.length?($(e).html(i.slice(0,n++)+"_"),a=setTimeout(o,100)):($(e).html(i),clearTimeout(a))};o()})}init_life_time(){function t(){let t=+new Date,e=new Date((new Date).toLocaleDateString()).getTime(),i=(t-e)/1e3/60/60,a=i/24*100;$("#dayProgress .title span").html(parseInt(i)),$("#dayProgress .progress .progress-inner").css("width",parseInt(a)+"%"),$("#dayProgress .progress .progress-percentage").html(parseInt(a)+"%");let n={0:7,1:1,2:2,3:3,4:4,5:5,6:6},o=n[(new Date).getDay()],s=o/7*100;$("#weekProgress .title span").html(o),$("#weekProgress .progress .progress-inner").css("width",parseInt(s)+"%"),$("#weekProgress .progress .progress-percentage").html(parseInt(s)+"%");let r=(new Date).getFullYear(),l=(new Date).getDate(),d=(new Date).getMonth()+1,c=new Date(r,d,0).getDate(),h=l/c*100;$("#monthProgress .title span").html(l),$("#monthProgress .progress .progress-inner").css("width",parseInt(h)+"%"),$("#monthProgress .progress .progress-percentage").html(parseInt(h)+"%");let p=d/12*100;$("#yearProgress .title span").html(d),$("#yearProgress .progress .progress-inner").css("width",parseInt(p)+"%"),$("#yearProgress .progress .progress-percentage").html(parseInt(p)+"%")}t(),setInterval(()=>{t()},1e3)}init_aside_reply(){$("#asideReply a").each(function(t,e){let i=$(e).html();/\{!\{.*/.test(i)?$(e).html("# 图片回复"):$(e).html(i),$(e).css("display","-webkit-box"),$(e).attr("href").includes("#")&&$(e).attr("href",$(e).attr("href").replace("#","?jscroll="))})}init_file_toggle(){$(".j-file .panel").first().next().slideToggle(0),$(".j-file .panel").on("click",function(){let t=$(this).next();t.slideToggle(200),$(".j-file .panel-body").not(t).slideUp()})}init_floor_click(){"on"!==window.JOE_CONFIG.IS_MOBILE&&$(".j-floor a").on("click",function(t){t.preventDefault(),window.scroll({top:$($(this).attr("data-href")).offset().top-($(".j-header").height()+20),behavior:"smooth"})})}init_drop_down(){$(".j-drop").on("click",function(t){t.stopPropagation(),$(this).siblings(".j-dropdown").hasClass("active")?$(this).siblings(".j-dropdown").removeClass("active"):($(".j-dropdown").removeClass("active"),$(this).siblings(".j-dropdown").addClass("active"))}),$(document).on("click",t=>$(".j-dropdown").removeClass("active")),$(".j-dropdown[stop-propagation]").on("click",function(t){t.stopPropagation()})}init_panel_down(){$(".j-panel").on("click",function(){let t=$(this).next();$(this).next().stop().slideToggle(),$(".j-panel-down").not(t).slideUp()})}init_aside_config(){let t=$(".j-aside").width();t>0&&($(".j-stretch").addClass("active"),$(".j-aside").css("width",t)),$(".j-aside .aside").last().css("top",$(".j-header").height()+20),$(".j-floor .contain").css("top",$(".j-header").height()+20),$(".j-stretch .contain").css("top",$(".j-header").height()+20),$(".j-stretch .contain").on("click",function(){0===$(".j-aside").width()?($(".j-aside").css("width",t),$(".j-aside").css("overflow","")):($(".j-aside").css("width",0),$(".j-aside").css("overflow","hidden")),$("#commentType button[data-type='text']").click()})}init_sign_verify(){$("#loginForm").on("submit",function(t){return""===$("#loginForm .username").val().trim()?(t.preventDefault(),$.toast({type:"warning",message:"请输入用户名！"})):""===$("#loginForm .password").val().trim()?(t.preventDefault(),$.toast({type:"warning",message:"请输入密码！"})):void 0}),$("#registerForm").on("submit",function(t){return""===$("#registerForm .username").val().trim()?(t.preventDefault(),$.toast({type:"warning",message:"请输入用户名！"})):""===$("#registerForm .mail").val().trim()?(t.preventDefault(),$.toast({type:"warning",message:"请输入邮箱！"})):/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test($("#registerForm .mail").val())?void 0:(t.preventDefault(),$.toast({type:"warning",message:"请输入正确的邮箱！"}))})}init_pagination_hash(){$(".j-pagination a").each((t,e)=>{$(e).attr("href")&&$(e).attr("href").includes("#")&&$(e).attr("href",$(e).attr("href").replace("#","?jscroll="))})}init_replay_content(){$(".replyContent p").each(function(t,e){let i=$(e).html();/\{!\{.*\}!\}/.test(i)&&(i=i.replace(/{!{/,"").replace(/}!}/,""),$(e).html('<img class="canvas" src="'+i+'" />'))}),$(".replyContent").show()}init_comment(){$("#commentType button").on("click",function(){$("#commentType button").removeClass("active"),$(this).addClass("active"),"canvas"===$(this).attr("data-type")?($("#draw").prop("width",$("#commentTypeContent").width()),$("#commentTypeContent textarea").hide(),$("#commentTypeContent .canvas").show(),$("#commentTypeContent .canvas").attr("data-type","canvas")):($("#commentTypeContent textarea").show(),$("#commentTypeContent .canvas").hide(),$("#commentTypeContent .canvas").attr("data-type","text"))}),$(".comment-list .meta a").on("click",function(){$("#draw").prop("width",$("#commentTypeContent").width())}),$("#cancel-comment-reply-link").on("click",function(){$("#draw").prop("width",$("#commentTypeContent").width())})}init_leaving(){function t(t,e){return Math.floor(Math.random()*(e-t+1))+t}let e=100;$("#j-leaving li").each(function(i,a){$(a).find(".body .content p").each(function(t,e){let i=$(e).html();/\{!\{.*\}!\}/.test(i)&&(i=i.replace(/{!{/,"").replace(/}!}/,""),$(e).html('<img class="canvas" src="'+i+'" />'))}),$(a).css({"z-index":t(1,99),"background-color":`rgba(${t(0,255)}, ${t(0,255)}, ${t(0,255)}, ${t(.8,1)})`,top:parseInt(Math.random()*($("#j-leaving").height()-$(a).height()),10),left:parseInt(Math.random()*($("#j-leaving").width()-$(a).width()),10),display:"flex"}),$(a).draggabilly({containment:!0}),$(a).on("dragStart",function(t){e++,$(a).css("z-index",e)})})}init_wap_search_click(){$(".j-search-toggle").on("click",function(){$(this).toggleClass("active"),$(this).hasClass("active")?($(".j-nav").hide(),$(".j-search").css("display","flex")):($(".j-nav").css("display","flex"),$(".j-search").hide())})}init_search_verify(){$(".j-search").on("submit",function(t){if(""===$(".j-search input").val().trim())return t.preventDefault(),$.toast({type:"warning",message:"请输入搜索内容！"})})}init_protect_verify(){let t=this;$("#j-protected").on("submit",e=>{if(e.preventDefault(),""===$("#j-protected").find(".pass").val())return $.toast({type:"info",message:"请输入访问密码！"});let i=$("#j-protected").attr("action");$.ajax({url:i,method:"post",datatype:"text",data:{protectPassword:$("#j-protected").find(".pass").val(),cid:$("#j-protected").find(".cid").val()},success:e=>{let i=[],a="";if(i=$(e).contents(),Array.from(i).forEach(t=>{"container"===t.parentNode.className&&(a=t)}),/TypechoJoeTheme/.test(e)){let e=location.href;e=t.changeURLArg(e,"jscroll","comments"),$.toast({type:"success",message:"密码正确，即将刷新本页！"}),setTimeout(function(){window.location.href=e},t.options.reloadTime)}else $.toast({type:"warning",message:a.textContent||""})}})})}init_dynamic_verify(){let t=this;$("#j-dynamic-form").on("submit",function(e){if(e.preventDefault(),""===$("#j-dynamic-form-text").val().trim())return $.toast({type:"info",message:"请输入发表内容！"});$(this).attr("data-disabled")||($(this).attr("data-disabled",!0),$.ajax({url:$(this).attr("action"),type:"post",data:$(this).serializeArray(),success:e=>{let i=[],a="";if(i=$(e).contents(),Array.from(i).forEach(t=>{"container"===t.parentNode.className&&(a=t)}),/TypechoJoeTheme/.test(e)){let e=location.href;e=t.changeURLArg(e,"jscroll","comments"),$.toast({type:"success",message:"发表成功，即将刷新本页！"}),setTimeout(function(){window.location.href=e},t.options.reloadTime)}else $.toast({type:"warning",message:a.textContent||""}),$(this).removeAttr("data-disabled")}}))})}init_comment_submit(){let t=this;$("#comment-form").on("submit",function(e){if(e.preventDefault(),""===$("#comment-nick").val().trim())return $.toast({type:"warning",message:"请输入您的昵称！"});if(!/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test($("#comment-mail").val()))return $.toast({type:"warning",message:"请输入正确的邮箱！"});if("canvas"===$("#commentTypeContent .canvas").attr("data-type")){let t=$("#draw")[0].toDataURL("image/webp",.1);$("#comment-content").val("{!{"+t+"}!} ")}if(""===$("#comment-content").val().trim())return $.toast({type:"warning",message:"请输入评论内容！"});$(this).attr("data-disabled")||($(this).attr("data-disabled",!0),$(this).find("button[type='submit']").html("请等待..."),$.ajax({url:$(this).attr("action"),type:"post",data:$(this).serializeArray(),success:e=>{let i=[],a="";if(i=$(e).contents(),Array.from(i).forEach(t=>{"container"===t.parentNode.className&&(a=t)}),/TypechoJoeTheme/.test(e)){let e=location.href;e=t.changeURLArg(e,"jscroll","comments"),$.toast({type:"success",message:"发送成功，即将刷新本页！"}),setTimeout(function(){window.location.href=e},t.options.reloadTime)}else $.toast({type:"warning",message:a.textContent||""}),$(this).removeAttr("data-disabled"),$(this).find("button[type='submit']").html("发表评论")}}))})}init_wap_cloud(){let t=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;$("#search-cloud a").each((e,i)=>{$(i).css("background",`rgba(${t(0,255)}, ${t(0,255)}, ${t(0,255)}, ${t(.8,1)})`)})}init_wap_search(){$(".search-toggle-xs").on("click",function(){$(".j-slide").removeClass("active"),$(".j-sidebar-xs").removeClass("active"),$(".j-search-down-xs").toggleClass("active"),$(".j-search-down-xs").hasClass("active")?($("body").css("overflow","hidden"),$(".j-header").css("box-shadow","none")):($("body").css("overflow",""),$(".j-header").css("box-shadow",""))}),$(".j-search-down-xs .mask").on("click",function(){$(".j-search-down-xs").removeClass("active"),$("body").css("overflow",""),$(".j-header").css("box-shadow","")})}init_wap_sidebar(){$(".j-slide").on("click",function(t){$(".j-search-down-xs").removeClass("active"),$("body").css("overflow",""),$(".j-header").css("box-shadow",""),$(this).toggleClass("active"),$(".j-sidebar-xs").toggleClass("active"),$(this).hasClass("active")?$("body").css("overflow","hidden"):$("body").css("overflow","")}),$(".j-sidebar-xs .mask").on("click",function(){$(".j-slide").removeClass("active"),$(".j-sidebar-xs").removeClass("active"),$("body").css("overflow","")})}init_wow(){if(!("on"===window.JOE_CONFIG.IS_MOBILE&&"off"===window.JOE_CONFIG.DOCUMENT_WAP_ANIMATION||"off"===window.JOE_CONFIG.IS_MOBILE&&"off"===window.JOE_CONFIG.DOCUMENT_PC_ANIMATION)){var t=new WOW({boxClass:"wow",animateClass:"animated",offset:0,mobile:!0,live:!0,scrollContainer:null});t.init()}}init_video_list_type(){if(0===$("#j-video-type").length)return;if(""===window.JOE_CONFIG.VIDEO_LIST_API)return $.toast({type:"warning",message:"苹果CMS API未填写！"});$(".j-video-load-1").show(),$.ajax({url:window.JOE_CONFIG.VIDEO_LIST_API,method:"get",data:{ac:"list",at:"json"},dataType:"json",success:t=>{if(1!==t.code)return $.toast({type:"warning",message:"获取列表失败！"});$(".j-video-load-1").hide();let e='<li class="active">全部</li>',i=window.JOE_CONFIG.VIDEO_LIST_SHIELD.split("||"),a=i.map(t=>t.trim());t.class.forEach(t=>{a.some(e=>e===t.type_name)||(e+=`<li data-id="${t.type_id}">${t.type_name}</li>`)}),$("#j-video-type").html(e)}});let t=this;$(document).on("click","#j-video-type li",function(){$(this).addClass("active").siblings().removeClass("active"),t.video_page=0,$("#j-video-list").html(""),t.init_video_list($(this).attr("data-id"))})}init_video_list(t,e){if(0===$("#j-video-list").length)return;let i=this;i.video_canLoad&&(i.video_canLoad=!1,i.video_page+=1,$(".j-video-load-2").show(),$.ajax({url:window.JOE_CONFIG.VIDEO_LIST_API,method:"get",data:{pg:i.video_page,ac:"videolist",at:"json",t:t,wd:e},dataType:"json",success:t=>{1===t.code&&($(".j-video-load-2").hide(),t.list.forEach(t=>{$("#j-video-list").append(`\n                                <li>\n                                    <a href="${window.location.href+"?vod_id="+t.vod_id}">\n                                        <img class="lazyload" src="${window.JOE_CONFIG.DOCUMENT_LAZY_LOAD}" data-original="${t.vod_pic}">\n                                        <h2>${t.vod_name}</h2>\n                                        ${t.vod_year&&0!=t.vod_year?"<i>"+t.vod_year+"</i>":""}\n                                    </a>\n                                </li>\n                            `)}),i.init_lazy_load(),i.video_canLoad=!0)}}))}init_video_search(){let t=this;$("#j-video-search button").on("click",function(){if(""===$("#j-video-search input").val().trim())return $.toast({type:"info",message:"请输入内容！"});t.video_page=0,$("#j-video-list").html(""),t.init_video_list(null,$("#j-video-search input").val())})}init_load_more_video(){if(0===$("#j-video-list").length)return;let t=this;$(window).on("scroll",function(){let e=$(window).scrollTop(),i=$(window).height(),a=$("#j-video-list").offset().top+$("#j-video-list").height();e+i>=a&&t.init_video_list()})}init_video_detail(){let t=new URLSearchParams(window.location.search),e=t.get("vod_id");e&&($(".j-video-load-3").show(),$.ajax({url:window.JOE_CONFIG.VIDEO_LIST_API,method:"get",data:{ac:"detail",at:"json",ids:e},dataType:"json",success:t=>{function e(t){let e=t.split("$");return{name:e[0]||"",link:e[1]||""}}if(1!==t.code||1!==t.list.length)return $.toast({type:"warning",message:"数据获取失败！"});$(".j-video-load-3").hide();let i=t.list[0];$("#j-video-info").html(`\n\t\t\t\t\t\t<div class="image">\n\t\t\t\t\t\t\t<img class="lazyload" src="${window.JOE_CONFIG.DOCUMENT_LAZY_LOAD}" alt="${i.vod_name}" data-original="${i.vod_pic}" title="${i.vod_name}">\n\t\t\t\t\t\t\t${i.vod_year&&0!==i.vod_year?"<i>"+i.vod_year+"</i>":""}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<dl>\n\t\t\t\t\t\t\t<dt>${i.vod_name+(i.vod_remarks?" - "+i.vod_remarks:"")}</dt>\n\t\t\t\t\t\t\t<dd>\n\t\t\t\t\t\t\t\t<span>类型：</span>\n\t\t\t\t\t\t\t\t<span>${i.vod_class||"未知"}</span>\n\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t<dd>\n\t\t\t\t\t\t\t\t<span>主演：</span>\n\t\t\t\t\t\t\t\t<span>${i.vod_actor||"未知"}</span>\n\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t<dd>\n\t\t\t\t\t\t\t\t<span>导演：</span>\n\t\t\t\t\t\t\t\t<span>${i.vod_director||"未知"}</span>\n\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t\t<dd>\n\t\t\t\t\t\t\t\t<span>简介：</span>\n\t\t\t\t\t\t\t\t<span>${i.vod_content?i.vod_content:i.vod_blurb}</span>\n\t\t\t\t\t\t\t</dd>\n\t\t\t\t\t\t</dl>\n\t\t\t\t\t`),this.init_lazy_load();let a=i.vod_play_from.split("$$$"),n=i.vod_play_url.split("$$$"),o=new Map;for(var[s,r]of(a.forEach((t,e)=>{o.set(t,n[e]||[])}),o)){let t=r.split("#"),i="";t.forEach(t=>{i+=`\n\t\t\t\t\t\t\t\t<li data-link="${e(t).link}">${e(t).name}</li>\n\t\t\t\t\t\t\t`}),$("#j-video-play").append(`\n\t\t\t\t\t\t\t<div class="video-list-play">\n\t\t\t\t\t\t\t\t<div class="title">源：${s}</div>\n\t\t\t\t\t\t\t\t<ul class="list-item">\n\t\t\t\t\t\t\t\t\t${i}\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`)}if(!$("#j-video-player iframe").attr("data-src")||""===$("#j-video-player iframe").attr("data-src"))return;$(".video-list-play .list-item li").on("click",function(){$(".video-list-play .list-item li").removeClass("active"),$(this).addClass("active"),$("#j-video-player iframe").attr("src",$("#j-video-player iframe").attr("data-src")+$(this).attr("data-link")),sessionStorage.setItem("playUrl",$(this).attr("data-link"))});let l=$("#j-video-play .video-list-play:first-child .list-item li:first-child");if(0!==l.length){if(sessionStorage.getItem("playUrl")){let t=null;$(".video-list-play .list-item li").each((e,i)=>{$(i).attr("data-link")===sessionStorage.getItem("playUrl")&&($(i).addClass("active"),t=!0)}),!0===t?$("#j-video-player iframe").attr("src",$("#j-video-player iframe").attr("data-src")+sessionStorage.getItem("playUrl")):($("#j-video-player iframe").attr("src",$("#j-video-player iframe").attr("data-src")+l.attr("data-link")),l.addClass("active"))}else $("#j-video-player iframe").attr("src",$("#j-video-player iframe").attr("data-src")+l.attr("data-link")),l.addClass("active");$("#j-video-player-title").html("正在播放："+i.vod_name)}}}))}init_j_tabs(){$(".j-tabs .nav span").on("click",function(){let t=$(this).attr("data-panel");$(this).addClass("active").siblings().removeClass("active"),$(this).parents(".j-tabs").find(".content div").hide(),$(this).parents(".j-tabs").find(".content div[data-panel="+t+"]").show()})}init_j_collapse(){$(".j-collapse .collapse-head").on("click",function(){let t=$(this).next();t.slideToggle(200),$(".j-collapse .collapse-body").not(t).slideUp()})}init_aside_motto(){"on"===window.JOE_CONFIG.DOCUMENT_ASIDE_MOTTO?$(".j-aside-motto").show():$.ajax({
url:window.JOE_CONFIG.DOCUMENT_MOTTO_API,method:"get",dataType:"text",success:t=>{$(".j-aside-motto").html(t),$(".j-aside-motto").show()},error:t=>{$(".j-aside-motto").html("人生之路，难免坎坷，但我执着"),$(".j-aside-motto").show()}})}init_comment_like(){$(".j-comment-like").on("click",function(){if($(this).hasClass("active"))return $.toast({type:"warning",message:"本条评论您已经赞过~"});$.ajax({url:window.location.href,type:"post",data:"likeup="+$(this).attr("data-coid"),timeout:3e4,cache:!1,success:t=>{let e=/\d/;e.test(t)&&$(this).find("span").html(t.trim()),$.toast({type:"success",message:"点赞成功！"}),$(this).addClass("active")}})})}init_dynamic_reply(){let t=this;$(document).on("click",()=>$(".j-dynamic-reply").hide()),$(".j-comment-reply").on("click",function(t){t.stopPropagation(),$(this).parents("li").find(".j-dynamic-reply").toggle()}),$(".j-dynamic-reply").on("click",t=>t.stopPropagation()),$(".j-dynamic-reply").on("submit",function(e){return e.preventDefault(),""===$(this).find("input[name='author']").val().trim()?$.toast({type:"warning",message:"请输入您的昵称！"}):/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test($(this).find("input[name='mail']").val())?""===$(this).find("textarea[name='text']").val().trim()?$.toast({type:"warning",message:"请输入回复内容！"}):void($(this).attr("data-disabled")||($(this).attr("data-disabled",!0),$.ajax({url:$(".j-comment-url").val(),type:"post",data:$(this).serializeArray(),success:e=>{let i=[],a="";if(i=$(e).contents(),Array.from(i).forEach(t=>{"container"===t.parentNode.className&&(a=t)}),/TypechoJoeTheme/.test(e)){let e=location.href;e=t.changeURLArg(e,"jscroll","comments"),$.toast({type:"success",message:"发送成功，即将刷新本页！"}),setTimeout(function(){window.location.href=e},t.options.reloadTime)}else $.toast({type:"warning",message:a.textContent||""}),$(this).removeAttr("data-disabled")}}))):$.toast({type:"warning",message:"请输入正确的邮箱！"})})}init_video_album(){function t(t,e=1,i=1,a=.5){let n=document.createElement("VIDEO");return n.setAttribute("src",t),n.crossOrigin="*",n.currentTime=e,new Promise((t,e)=>{n.addEventListener("loadeddata",()=>{let e=document.createElement("canvas");e.width=n.videoWidth*i,e.height=n.videoHeight*i,e.getContext("2d").drawImage(n,0,0,e.width,e.height),t(e.toDataURL("image/webp",a))})})}$(".j-short-video .inner").each((e,i)=>{let a=$(i).attr("data-poster"),n=$(i).attr("data-src");isNaN(a)?$(i).css("background-image","url("+a+")"):t(n,a).then(t=>{$(i).css("background-image","url("+t+")")}),$(i).on("click",function(){$("body").css("overflow","hidden"),$(".j-video-preview").addClass("active"),$(".j-video-preview iframe").attr("src",window.JOE_CONFIG.THEME_URL+"/player.php?url="+n)})}),$(".j-video-preview .close").on("click",function(){$("body").css("overflow",""),$(".j-video-preview").removeClass("active")})}init_wallpaper(){if(0===$("#wallpaper-type").length)return;$.ajax({url:window.JOE_CONFIG.THEME_URL+"/wallpaperApi.php?cid=360tags",method:"get",dataType:"json",success:t=>{if("0"!==t.errno)return $.toast({type:"warning",message:"接口异常，请联系开发者！"});$(".j-wallpaper-load-1").hide();let e='<li data-cid="360new" class="active">最新壁纸</li>';t.data.forEach(t=>{e+=`<li data-cid="${t.id}">${t.name}</li>`}),$("#wallpaper-type").html(e),$("#wallpaper-type li").first().click()}});let t=this;$(document).on("click","#wallpaper-type li",function(){$(this).addClass("active").siblings().removeClass("active"),t.wallpaper_page=0,t.wallpaper_cid=$(this).attr("data-cid"),$("#wallpaper-list").html(""),t.init_wallpaper_list()}),$("#wallpaper-load").on("click",function(){t.wallpaper_page+=1,t.init_wallpaper_list()})}init_wallpaper_list(){let t=this;$(".j-wallpaper-load-2").show(),$.ajax({url:window.JOE_CONFIG.THEME_URL+"/wallpaperApi.php",data:{cid:t.wallpaper_cid,start:20*t.wallpaper_page,count:20},method:"get",dataType:"json",success:e=>{$(".j-wallpaper-load-2").hide(),0!=e.total?(e.data.forEach(t=>{$("#wallpaper-list").append(`\n                                <a class="item" data-fancybox="gallery" href="${t.url}">\n                                    <img class="lazyload" src="${window.JOE_CONFIG.DOCUMENT_LAZY_LOAD}" data-original="${t.img_1024_768}" />\n                                </a>\n                            `)}),t.init_lazy_load()):$("#wallpaper-load").remove()}})}init_huya_type(){if(0===$(".huya-list-type").length)return;let t=this;$(".huya-list-type .list ul li").on("click",function(){window.location.href=t.changeURLArg(window.location.href,"vid",$(this).attr("data-vid"))})}init_huya_skip(){if(0===$(".huya-list-go-play").length)return;let t=this;$(".huya-list-go-play").on("click",function(){let e=t.changeURLArg(window.location.href,"play",$(this).attr("data-href"));e=t.changeURLArg(e,"title",$(this).attr("data-title")),window.open(e)})}init_huya_pagination(){if(0===$(".huya-list-pagination").length)return;let t=this;$(".huya-list-pagination li").on("click",function(){let e=window.location.href;e=t.changeURLArg(e,"pg",$(this).attr("data-pg")),window.location.href=e})}init_lazy_load(){new LazyLoad(".lazyload")}}"undefined"!=typeof module&&void 0!==module.exports?module.exports=Joe:window.Joe=Joe})(),new Joe({});